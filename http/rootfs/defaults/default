server {
	listen 80 default_server;

	{{ if .Env.ENABLE_HTTP_REDIRECT | default "0" | toBool }}
	return 301 https://$host$request_uri;
	{{ else }}
	include /config/nginx/meet.conf;
	{{ end }}
}

{{ if not (.Env.DISABLE_HTTPS | default "0" | toBool) }}
server {
	listen 443 ssl http2;

	include /config/nginx/ssl.conf;
	include /config/nginx/meet.conf;
}
{{ end }}

server {
	listen 8080 ssl;

	include /config/nginx/ssl.conf;
	location /sockjs-web/ {
		proxy_pass https://{{ .Env.XMPP_DOMAIN }}:8080;

		proxy_redirect off;
		proxy_http_version 1.1;
		proxy_set_header Upgrade $http_upgrade;
		proxy_set_header Connection 'upgrade';
		proxy_set_header Host $host;
		proxy_set_header X-Forwarded-For $remote_addr;
		proxy_set_header X-Real-IP $remote_addr;
	}
}
